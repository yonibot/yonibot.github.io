<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <!-- (1) Optimize for mobile versions: http://goo.gl/EOpFl -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- (1) force latest IE rendering engine: bit.ly/1c8EiC9 -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Nested Attributes in ActiveAdmin for Rails 4</title>
    <meta name="google-site-verification" content="IvI-f1O6L1khbEAaZYBJgCgXkKlGLC0BoEJHknvESbk" />
    <meta name="description" content="This post explains how to implement nested attributes with ActiveAdmin in Rails 4, including deleting associated records." />

    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Nested Attributes in ActiveAdmin for Rails 4">
    <meta name="twitter:description" content="This post explains how to implement nested attributes with ActiveAdmin in Rails 4, including deleting associated records.">
    <meta name="twitter:site" content="https://twitter.com/yoniweisbrod"> <!-- Change this to your URL -->
<meta name="twitter:creator" content="@yoniweisbrod"> <!-- Change this to your Twitter Handel -->
    <meta name="google-site-verification" content="">
    <meta property="fb:admins" content="">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Nested Attributes in ActiveAdmin for Rails 4">
    <meta property="og:description" content="This post explains how to implement nested attributes with ActiveAdmin in Rails 4, including deleting associated records.">

    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../assets/js/styles/obsidian.css?v=c58cbde4e4">
    <link rel="stylesheet" href="http://brick.a.ssl.fastly.net/Linux+Libertine:400,400i,700,700i/Open+Sans:400,400i,700,700i">
    <link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" media="screen" href="../assets/css/main.css?v=c58cbde4e4" />
    <link rel="stylesheet" type="text/css" media="print" href="../assets/css/print.css?v=c58cbde4e4" />
    <script src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
    <meta name="generator" content="Ghost 0.5" />
<link rel="alternate" type="application/rss+xml" title="Yoni Weisbrod" href="../rss/index.html">
<link rel="canonical" href="http://localhost:2368/nested-attributes-in-activeadmin-for-rails-4/" />
</head>
<body class="post-template">

    <a href="http://localhost:2368" class="logo-readium"><span class="logo" style="background-image: url(../content/images/2014/10/linkedin-logo-1.jpg)"></span></a>
    
<!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="http://s7.addthis.com/js/300/addthis_widget.js#pubid=ra-542fcb246139f253" async></script>

<main class="content" role="main">

    <article class="post">



        <div class="noarticleimage">
            <div class="post-meta">
                <h1 class="post-title">Nested Attributes in ActiveAdmin for Rails 4</h1>
                <div class="cf post-meta-text">
                    <div class="author-image" style="background-image: url(http://www.gravatar.com/avatar/2fd017fbcb4fcdf8f936ffeb9c4ca32f?d=404&amp;s=250)">Blog Logo</div>
                    <h4 class="author-name" itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="../author/yoni/index.html">Yoni</a></h4> on
                    <time datetime="2014-07-11">11 Jul 2014</time>, tagged on 
                </div>
            </div>
        </div>
        <br>
        <br>
        <br>



            <section class="post-content">
                <div class="post-reading">
                    <span class="post-reading-time"></span> read
                </div>
                <a name="topofpage"></a>
                <p>There have recently been significant changes to ActiveAdmin, specifically moving from meta_search to ransack and unfortunately there is a dearth of documentation on the subject. You might have noticed that creating custom filters is done completely differently now, for instance.</p>

<p>One of my newer projects uses Rails 4, so I get an opportunity to explore strong parameters in greater depth. This post explains how to implement nested attributes with ActiveAdmin in Rails 4, including deleting associated records.</p>

<h4 id="thescenario">The scenario</h4>

<p>A Video has many video-titles (another table), which serve as alternate titles for the video. A Title has video id, title, and primary (bool) fields.</p>

<p>An admin can add and delete alternate titles to a Video from the Video form.</p>

<h5 id="thesolution">The solution:</h5>

<p>Three simple steps. First whitelist the relevant attributes in ActiveAdmin. Then use formtastic's simple <code>has_many</code> syntax to add the nested attributes to the form. Lastly, add the <code>accepts_nested_attributes_for</code> method in the model.</p>

<h6 id="whitelisttherelevantattributes">Whitelist the relevant attributes</h6>

<p>Whitelisting the (non-nested) model attributes is done like so:  </p>

<pre><code class="ruby">ActiveAdmin.register Video do  
    permit_params :description, :url, :author # etc
</code></pre>

<p>Any data sent through an ActiveAdmin form as a list requires whitelisting it in array form. That includes nested attributes and virtual attributes that take an array. For handling of nested attributes by ActiveAdmin, the attributes themselves must be included in the array declaration:</p>

<pre><code class="ruby">permit_params :description, video_titles_attributes: [:id, :title, :primary, :_destroy]  
</code></pre>

<p>Note the inclusion of <code>:_destroy</code> – this allows associated records to be destroyed through the form itself.</p>

<h6 id="addthenestedattributestotheform">Add the nested attributes to the form</h6>

<p>Use the <em>formtastic</em> has many syntax to add the inputs to the form. Optional parameters are <code>new_record</code> (bool, defaults to true) and <code>allow_destroy</code> (bool, defaults to false).</p>

<pre><code class="ruby">f.inputs "Details" dp  
  f.input :url
  f.has_many :video_titles, allow_destroy: true do |ff|
    ff.input :title
    ff.input :primary
  end
end  
</code></pre>

<h6 id="acceptnested_attributesinthemodel">Accept nested_attributes in the model</h6>

<p>Remember to <code>allow_destroy</code> from nested forms:</p>

<pre><code class="ruby">class Video &lt; ActiveRecord::Base  
  accepts_nested_attributes_for :video_titles, allow_destroy: true
</code></pre>

<p>And that’s it! Feel free to post in the comments if you have any issues with the above.</p>
            </section>
            <footer class="post-footer">
                <section class="share">
                    <a class="icon-twitter" href="http://twitter.com/share?text=Nested%20Attributes%20in%20ActiveAdmin%20for%20Rails%204&url=http://localhost:2368/nested-attributes-in-activeadmin-for-rails-4/"
                        onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                        <span class="hidden">Twitter</span>
                    </a>
                    <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:2368/nested-attributes-in-activeadmin-for-rails-4/"
                        onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                        <span class="hidden">Facebook</span>
                    </a>
                    <a class="icon-google-plus" href="https://plus.google.com/share?url=http://localhost:2368/nested-attributes-in-activeadmin-for-rails-4/"
                       onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                        <span class="hidden">Google+</span>
                    </a>
                </section>
            </footer>
            <div class="bottom-teaser cf">
                <div class="isLeft">
                    <h5 class="index-headline featured"><span>Written by</span></h5>
                    <section class="author">
                        <div class="author-image" style="background-image: url(http://www.gravatar.com/avatar/2fd017fbcb4fcdf8f936ffeb9c4ca32f?d=404&amp;s=250)">Blog Logo</div>
                        <h4><a href="../author/yoni/index.html">Yoni</a></h4>
                        <p class="bio"></p>
                        <hr>
                        <p class="published">Published <time datetime="2014-07-11">11 Jul 2014</time></p>
                    </section>
                </div>
                <div class="isRight">
                    <h5 class="index-headline featured"><span>Supported by</span></h5>
                    <footer class="site-footer">
                        <section class="poweredby">Proudly published with <a class="icon-ghost" href="http://ghost.org"> Ghost</a></section>
                        <a class="subscribe" href="http://localhost:2368/rss/"><span class="tooltip">You should subscribe to my RSS feed.</span></a>
                        <div class="inner">
                             <section class="copyright">All content copyright <a href="http://localhost:2368/">Yoni Weisbrod</a> &copy; 2014<br>All rights reserved.</section>

                        </div>
                    </footer>
                </div>
            </div>

    </article>

</main>

<div class="bottom-closer">
    <div class="background-closer-image" style="background-image: url(../content/images/2014/10/workshop-3-copy.jpg)">
        Image
    </div>
    <div class="inner">
        <h1 class="blog-title">Yoni Weisbrod</h1>
        <h2 class="blog-description">Fresh Rails and AngularJS insights from the field</h2>
        <a href="../index.html" class="btn">Back to Overview</a>
    </div>
</div>


    <script src="../public/jquery.js?v=c58cbde4e4"></script>

    <script type="text/javascript" src="../assets/js/jquery.fitvids.js?v=c58cbde4e4"></script>
    <script type="text/javascript" src="../assets/js/index.js?v=c58cbde4e4"></script>
    <script src="../assets/js/readingTime.min.js?v=c58cbde4e4"></script>
    <script src="../assets/js/highlight.pack.js?v=c58cbde4e4"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    
    <script>
        
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    
      ga('create', 'UA-55415255-1', 'yoniweisbrod.com'); 
      ga('send', 'pageview');
    
    </script>

</body>
</html>
